#!/usr/bin/env python3
import re
import os
import webbrowser

# üîç –§–∞–π–ª —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ –æ—Ç GitHub –ø—Ä–∏ push
GIT_LOG_FILE = ".last_push_error.log"

# ‚úÖ –ï—Å–ª–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ —Å–∫—Ä–∏–ø—Ç–∞ 10 –∏–ª–∏ 11 ‚Äî GitHub –æ—Ç–≤–µ—Ç –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
GITHUB_REPO_URL = "https://github.com/DeViLs9966/rita_mega_bot"

print("üì¶ [AutoUnblockPush] –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∂—É—Ä–Ω–∞–ª –æ—à–∏–±–∫–∏ push...")

if not os.path.exists(GIT_LOG_FILE):
    print(f"‚ùå –§–∞–π–ª {GIT_LOG_FILE} –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—É—à –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è –∏–ª–∏ –∂—É—Ä–Ω–∞–ª –Ω–µ –∑–∞–ø–∏—Å–∞–Ω.")
    print("üí° –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏ git push –∏ —Å–∫–æ–ø–∏—Ä—É–π –æ—à–∏–±–∫—É –≤ .last_push_error.log")
    exit(1)

with open(GIT_LOG_FILE, "r", encoding="utf-8") as f:
    log = f.read()

# –ò—â–µ–º –≤—Å–µ URL –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
urls = re.findall(r"https://github.com/.*/security/secret-scanning/unblock-secret/[a-zA-Z0-9]+", log)
if not urls:
    print("‚úÖ –ù–µ—Ç —Å—Å—ã–ª–æ–∫ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ push. –ü—É—à –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å.")
    exit(0)

print(f"üö® –ù–∞–π–¥–µ–Ω–æ {len(urls)} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤!\n")

for idx, url in enumerate(urls, 1):
    print(f"{idx}. üîó {url}")

# –°–ø—Ä–∞—à–∏–≤–∞–µ–º ‚Äî –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ?
answer = input("\nüåê –•–æ—á–µ—à—å –æ—Ç–∫—Ä—ã—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ? (y/n): ").strip().lower()
if answer == 'y':
    for url in urls:
        print(f"üì§ –û—Ç–∫—Ä—ã–≤–∞—é: {url}")
        webbrowser.open(url)

print("\n‚úÖ –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ ‚Äî —Å–¥–µ–ª–∞–π git push --force —Å–Ω–æ–≤–∞.")
print("–ü—Ä–∏–º–µ—Ä:\n  git push origin main --force\n")
