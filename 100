import os
import re
import shutil

FILENAME = "check_bot_diagnostics.py"
BACKUP = FILENAME + ".bak"
ADMIN_ID_VAR = "TELEGRAM_ADMIN_ID"

# –°—Ç—Ä–æ–∫–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ –∏ —à–∞–±–ª–æ–Ω–∞–º–∏ –∑–∞–º–µ–Ω
replacements = {
    975:  'await send_admin_message("‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.")',
    978:  'await send_admin_message("‚úÖ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.")',
    2056: 'await send_admin_message(error_report)',
    2067: 'await send_admin_message("üõ† check_bot_diagnostics.py –±—ã–ª –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.")',
    2180: 'await send_admin_message("rita_main.py –±—ã–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.")',
    2215: 'await send_admin_message("üõ† –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.")',
    2233: 'await send_admin_message(error_report)',
    2242: 'await send_admin_message("üõ† check_bot_diagnostics.py –æ–±–Ω–æ–≤–ª—ë–Ω.")',
    2685: 'await send_admin_message(f"',
    2804: 'await send_admin_message(f"',
}

def main():
    if not os.path.exists(FILENAME):
        print(f"‚ùå –§–∞–π–ª {FILENAME} –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return

    # –°–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
    if not os.path.exists(BACKUP):
        shutil.copyfile(FILENAME, BACKUP)
        print(f"üßæ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: {BACKUP}")
    else:
        print(f"‚ö†Ô∏è –ë—ç–∫–∞–ø —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {BACKUP}")

    with open(FILENAME, "r", encoding="utf-8") as f:
        lines = f.readlines()

    updated_lines = []
    for idx, line in enumerate(lines, 1):
        stripped = line.strip()
        if idx in replacements and stripped.startswith("await send_admin_message"):
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö –∏ f-—Å—Ç—Ä–æ–∫
            if "error_report" in stripped:
                new_line = f"await send_admin_message({ADMIN_ID_VAR}, error_report)"
            elif stripped.startswith("await send_admin_message(f"):
                new_line = stripped.replace("await send_admin_message(f", f"await send_admin_message({ADMIN_ID_VAR}, f")
            else:
                match = re.match(r'await send_admin_messageÓÄÅ(.*)ÓÄÅ', stripped)
                if match:
                    arg = match.group(1)
                    new_line = f"await send_admin_message({ADMIN_ID_VAR}, {arg})"
                else:
                    print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å: {stripped}")
                    new_line = line
            indent = line[:len(line) - len(line.lstrip())]
            updated_lines.append(f"{indent}{new_line}\n")
            print(f"‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ: —Å—Ç—Ä–æ–∫–∞ {idx}")
        else:
            updated_lines.append(line)

    with open(FILENAME, "w", encoding="utf-8") as f:
        f.writelines(updated_lines)

    print("‚úÖ –í—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.")

if __name__ == "__main__":
    main()
