import os
import re

FILE = "check_bot_diagnostics.py"
BACKUP = FILE + ".bak"

def backup():
    if not os.path.exists(BACKUP):
        with open(FILE, "r", encoding="utf-8") as f:
            content = f.read()
        with open(BACKUP, "w", encoding="utf-8") as f:
            f.write(content)
        print(f"‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: {BACKUP}")
    else:
        print(f"‚ö†Ô∏è –ë—ç–∫–∞–ø —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {BACKUP}")

def fix_all_admin_calls():
    with open(FILE, "r", encoding="utf-8") as f:
        content = f.read()

    # –ò—â–µ–º –≤—ã–∑–æ–≤—ã —Å –æ–¥–Ω–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º, –≤–∫–ª—é—á–∞—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ
    pattern = re.compile(r"send_admin_message\s*ÓÄÅ\s*([^ÓÄÅ,\n]+?)\s*ÓÄÅ", re.MULTILINE)
    fixed, count = pattern.subn(r"send_admin_message(\1, \"üîß AutoFix Message\")", content)

    if count > 0:
        with open(FILE, "w", encoding="utf-8") as f:
            f.write(fixed)
        print(f"‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—ã–∑–æ–≤–æ–≤ send_admin_message —Å 1 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º: {count}")
    else:
        print("‚ÑπÔ∏è –í—ã–∑–æ–≤–æ–≤ send_admin_message —Å 1 –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.")

if __name__ == "__main__":
    backup()
    fix_all_admin_calls()
